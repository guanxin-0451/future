![伴鱼架构图](https://cynthia-oss.oss-cn-beijing.aliyuncs.com/1632643763404.png)
![架构图2](https://cynthia-oss.oss-cn-beijing.aliyuncs.com/1632643792243.png)


### 设计题
#### 秒杀系统瞬时高并发
  [秒杀系统](https://mp.weixin.qq.com/s/BxdBrgl-TR6Wz_yo07-5Lg)

  - 页面静态化  
    页面提前静态化初始化好（改价格怎么办？做强制刷新，版本控制等）   
  - CDN加速  
    网页直接挂cdn上
  - 秒杀按钮  
    控制置灰
  - 读多写少  
    库存不够时立刻返回失败 库存直接查redis 不负责下单付款结算等流程，只负责锁单。
    
    
  - 缓存
    不存在的也要入缓存，支持查空 接口级别可以加
    
  - mq异步处理
  - 限流
  - 分布式锁
  
  
    qps分析：
    5000+qps 
    单机mysql 千级别qps ，目前常规都是集群部署，也不能将请求全部落到mysql
    
    架构上选择：（5000+qps本身并不高，尽量提供扩展性好，能通过横向扩展/扩容等提高抗更高并发的能力）
    1.前端请求资源：动态数据读缓存，静态走cdn
    2. 秒杀链接：动态链接
    2.nginx 负载均衡
    3.api gateway  做限流，熔断 
    4. service 做本地缓存+redis缓存（设计时注意缓存击穿，雪崩），读库加锁。
    5. redis 集群: 操作库存 （多步操作使用lua脚本实现原子性操作），控制并发问题。
    6. MQ+db: 发mq，起消费者消费mq操作db库存扣减生成订单（削峰填谷，注意消息失败&重复消费的问题）